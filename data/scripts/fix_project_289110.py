#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞ 289110 –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
"""
import os
import sys
import json
from datetime import date
from sqlalchemy import create_engine, text
from sqlalchemy.orm import sessionmaker

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ app –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥–µ–ª–µ–π
sys.path.append('/app')
from app.models.project import Project, Base

def main():
    """–ò—Å–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ 289110"""
    print("üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ 289110...")
    
    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    database_url = os.getenv("DATABASE_URL", "postgresql://socfinder_user:Ant1$1ngleoe@postgres:5432/socfinder")
    print(f"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ: {database_url}")
    
    engine = create_engine(database_url)
    SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
    
    session = SessionLocal()
    
    try:
        # –ù–∞—Ö–æ–¥–∏–º –ø—Ä–æ–µ–∫—Ç 289110
        project = session.query(Project).filter(Project.id == 289110).first()
        
        if not project:
            print("‚ùå –ü—Ä–æ–µ–∫—Ç 289110 –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
            return
        
        print(f"‚úÖ –ù–∞–π–¥–µ–Ω –ø—Ä–æ–µ–∫—Ç: {project.name}")
        
        # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ 289110
        correct_data = {
            'name': '–ò–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª–∏ –±—É–¥—É—â–µ–≥–æ',
            'contest': '–ü–µ—Ä–≤—ã–π –∫–æ–Ω–∫—É—Ä—Å 2018',
            'year': 2018,
            'direction': '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–ª–æ–¥–µ–∂–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–¥—ã –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–µ–π 31.1 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –æ—Ç 12 —è–Ω–≤–∞—Ä—è 1996 –≥. ‚Ññ 7-–§–ó ¬´–û –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö¬ª',
            'date_req': date(2018, 3, 16),  # Date –æ–±—ä–µ–∫—Ç
            'region': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–∞—Ä–∏–π –≠–ª',
            'org': '–ë–õ–ê–ì–û–¢–í–û–†–ò–¢–ï–õ–¨–ù–´–ô –§–û–ù–î "–°–û–¶–ò–ê–õ–¨–ù–û–ï –†–ê–ó–í–ò–¢–ò–ï –ú–û–†–ö–ò–ù–°–ö–û–ì–û –†–ê–ô–û–ù–ê" –†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–∞—Ä–∏–π –≠–ª',
            'inn': '1208013762',
            'ogrn': '1141200000171',
            'implem_start': date(2018, 6, 1),  # Date –æ–±—ä–µ–∫—Ç
            'implem_end': date(2019, 11, 30),  # Date –æ–±—ä–µ–∫—Ç
            'winner': False,
            'rate': None,
            'money_req_grant': 2891105.83,
            'cofunding': 187436.34,
            'total_money': 3078542.17,
            'description': '–í –ú–æ—Ä–∫–∏–Ω—Å–∫–æ–º —Ä–∞–π–æ–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä–∞—è –∫–æ—Ä–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∏–∑–º–µ–Ω–∏—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å, –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, –∞ —Ç–∞–∫–∂–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–π. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —É—Å–ª–æ–≤–∏—è –∏ —Å—Ä–µ–¥—Å—Ç–≤–∞, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–≤–∏—Ç–∏—é —Ä–µ–±—ë–Ω–∫–∞ —É–∂–µ –Ω–∞—á–∏–Ω–∞—è —Å —Ä–∞–Ω–Ω–µ–≥–æ —à–∫–æ–ª—å–Ω–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞. –ú—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º LEGO ‚Äì –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫—É, –∫–∞–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è –¥–µ—Ç–µ–π, –≤ —Ä–∞–±–æ—Ç–µ –∫—Ä—É–∂–∫–æ–≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –Ω–∞ –±–∞–∑–µ –ú–û–£ –î–û ¬´–¶–µ–Ω—Ç—Ä –¥–µ—Ç—Å–∫–æ–≥–æ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞¬ª. –†–∞–±–æ—Ç–∞—è —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º LEGO, –¥–µ—Ç–∏ –º–æ–≥—É—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –æ–±—Å—É–∂–¥–∞—Ç—å –∏–¥–µ–∏, –≤–æ–ø–ª–æ—â–∞—Ç—å –∏—Ö –≤ –ø–æ—Å—Ç—Ä–æ–π–∫–µ –∏ —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å –∏—Ö. –ü–æ—ç—Ç–æ–º—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞—è —Å–æ–∑–∏–¥–∞—Ç–µ–ª—å–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å —è–≤–ª—è–µ—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–æ–π —Ä–∞–±–æ—Ç—ã, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ–¥–∞–≥–æ–≥—É —Å–æ—á–µ—Ç–∞—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –¥–µ—Ç–µ–π –≤ —Ä–µ–∂–∏–º–µ –∏–≥—Ä—ã. –í —Å–≤—è–∑–∏ —Å —ç—Ç–∏–º –º—ã —Å—á–∏—Ç–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LEGO-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å –¥–µ—Ç—å–º–∏ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ ¬´–ò–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª–∏ –±—É–¥—É—â–µ–≥–æ¬ª.',
            'goal': '–¶–µ–ª—å - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–µ–π—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –Ω–∞ –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ –¥–µ—Ç–µ–π, –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ –≤ —Å–æ–∑–∏–¥–∞—Ç–µ–ª—å–Ω–æ–µ –Ω–∞—É—á–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ø–æ —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–µ.',
            'tasks': '—Ä–∞–∑–≤–∏—Ç—å –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–∞–º–æ—Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–µ—Ç–µ–π –∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ –≤–æ–≤–ª–µ—á—å –¥–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–µ—Ç–µ–π –≤ –Ω–∞—É—á–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞—Ç—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ä–µ–¥—É –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –∏ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø',
            'soc_signif': '–ü—Ä–æ–µ–∫—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤—ã—è–≤–ª–µ–Ω–∏–µ, –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –Ω–∞—É—á–Ω–æ ‚Äì —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –¥–µ—Ç–µ–π. –ì–ª–∞–≤–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –±–∞–∑—ã, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è. –ù–∞—É—á–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–≥–æ –∏—Å–∫—É—Å—Å—Ç–≤–∞. –ê –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –≤–æ–∑—Ä–∞—Å—Ç–∞—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–æ—Å—Ç–∞–≤–ª—è—é—â–µ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ç–µ—Ö–Ω–∏–∫–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.',
            'pj_geo': '–º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ "–ú–æ—Ä–∫–∏–Ω—Å–∫–∏–π –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π —Ä–∞–π–æ–Ω"',
            'target_groups': '–î–µ—Ç–∏ –∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–∏',
            'address': '425120, —Ä–µ—Å–ø –ú–∞—Ä–∏–π –≠–ª, –ø–≥—Ç –ú–æ—Ä–∫–∏, –±-—Ä –ö–∞–ª–∏–Ω–∏–Ω–∞, –¥ 1',
            'web_site': 'http://mari-el.gov.ru/morki/Pages/main.aspx',
            'req_num': '18-1-009230',
            'link': 'https://–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∏–µ–≥—Ä–∞–Ω—Ç—ã.—Ä—Ñ/public/application/item?id=68a19aa4-e1e4-4e82-92aa-e6480f04c19e',
            'okato': '88000000',
            'oktmo': '88000000',
            'level': '—Ä–µ–≥–∏–æ–Ω',
            'coordinates': {"lat": 56.4307, "lng": 48.9964}  # Dict –æ–±—ä–µ–∫—Ç, –Ω–µ JSON —Å—Ç—Ä–æ–∫–∞
        }
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –ø–æ–ª—è
        for field, value in correct_data.items():
            if hasattr(project, field):
                setattr(project, field, value)
                print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–ª–µ {field}: {value}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        session.commit()
        print("üéâ –ü—Ä–æ–µ–∫—Ç 289110 —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        updated_project = session.query(Project).filter(Project.id == 289110).first()
        print(f"\nüìã –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:")
        print(f"ID: {updated_project.id}")
        print(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {updated_project.name}")
        print(f"–ö–æ–Ω–∫—É—Ä—Å: {updated_project.contest}")
        print(f"–ì–æ–¥: {updated_project.year}")
        print(f"–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: {updated_project.direction}")
        print(f"–†–µ–≥–∏–æ–Ω: {updated_project.region}")
        print(f"–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: {updated_project.org}")
        print(f"–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: {updated_project.winner}")
        print(f"–°—É–º–º–∞ –≥—Ä–∞–Ω—Ç–∞: {updated_project.money_req_grant} ‚ÇΩ")
        print(f"–û–ø–∏—Å–∞–Ω–∏–µ: {updated_project.description[:100]}...")
        
    except Exception as e:
        print(f"üí• –û—à–∏–±–∫–∞: {e}")
        session.rollback()
        raise
    finally:
        session.close()

if __name__ == "__main__":
    main()
